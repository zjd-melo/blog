<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="true">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zjd-melo.github.io","root":"/blog/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ES 备忘录">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch 备忘录">
<meta property="og:url" content="https://zjd-melo.github.io/blog/2024/06/14/ElasticSearch-%E5%A4%87%E5%BF%98%E5%BD%95/index.html">
<meta property="og:site_name" content="Dying Memory">
<meta property="og:description" content="ES 备忘录">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-06-14T08:03:42.000Z">
<meta property="article:modified_time" content="2024-06-14T08:03:42.000Z">
<meta property="article:author" content="朱佳东">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://zjd-melo.github.io/blog/2024/06/14/ElasticSearch-%E5%A4%87%E5%BF%98%E5%BD%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh_CN'
  };
</script>

  <title>ElasticSearch 备忘录 | Dying Memory</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Dying Memory</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Keep moving</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">16</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">75</span></a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/blog/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/zjd-melo" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh_CN">
    <link itemprop="mainEntityOfPage" href="https://zjd-melo.github.io/blog/2024/06/14/ElasticSearch-%E5%A4%87%E5%BF%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="朱佳东">
      <meta itemprop="description" content="melon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dying Memory">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ElasticSearch 备忘录
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-14 16:03:42" itemprop="dateCreated datePublished" datetime="2024-06-14T16:03:42+08:00">2024-06-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Search/" itemprop="url" rel="index"><span itemprop="name">Search</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>
            <div class="post-description">ES 备忘录</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="ES-不会平衡单节点上的数据"><a href="#ES-不会平衡单节点上的数据" class="headerlink" title="ES 不会平衡单节点上的数据"></a>ES 不会平衡单节点上的数据</h2><blockquote>
<p>Elasticsearch does not balance shards across a node’s data paths. High disk usage in a single path can trigger a high disk usage watermark for the entire node. If triggered, Elasticsearch will not add shards to the node, even if the node’s other paths have available disk space. If you need additional disk space, we recommend you add a new node rather than additional data paths.</p>
</blockquote>
<p>ES 节点在存在多个数据目录时并不会进行自动平衡操作，所以当一个数据路径达到一定的值时会触发一些机制，即使某些数据路径依然有大量存储空间，ES 也不会往那个节点分配分配了，所以不建议在节点上增加磁盘，更好的做法是增加节点。</p>
<h2 id="集群级别的分片分配和路由设置"><a href="#集群级别的分片分配和路由设置" class="headerlink" title="集群级别的分片分配和路由设置"></a>集群级别的分片分配和路由设置</h2><p>分片配置是指把索引分片分配到各节点上的过程，这个过程会发生在初始化恢复、副本分配、rebalance或者有节点加入/离开集群时。</p>
<p>Master 节点的一个主要功能就是决定哪个分片应该分配到哪个节点上、什么时候在节点之间移动分片来达到集群的平衡。</p>
<p>有如下几个设置可以控制分片分配的过程：</p>
<ul>
<li>集群级别的分片分配设置控制分配和再平衡操作</li>
<li>基于磁盘的分片分配设置解释了 ES 如何考虑到磁盘可用空间来控制分片分配</li>
<li>分片分配感知强制感知控制分片如何在不同的机架或空间/区域上分配</li>
<li>集群级别的分配分配过滤允许某些节点或者一组节点不参与分片分配，好让这些节点退役</li>
</ul>
<h2 id="集群级别的分片分片设置"><a href="#集群级别的分片分片设置" class="headerlink" title="集群级别的分片分片设置"></a>集群级别的分片分片设置</h2><p>可以用以下设置来控制分片的分配和恢复 </p>
<h3 id="cluster-routing-allocation-enable"><a href="#cluster-routing-allocation-enable" class="headerlink" title="cluster.routing.allocation.enable"></a>cluster.routing.allocation.enable</h3><ul>
<li>all 默认值 允许所有类型的分片的分配</li>
<li>primaries 只允许主分片分配</li>
<li>new_primaries 只允许新创建的索引的主分片分配</li>
<li>none 不允许任何索引分片进行分片分配</li>
</ul>
<h3 id="cluster-routing-allocation-node-concurrent-incoming-recoveries"><a href="#cluster-routing-allocation-node-concurrent-incoming-recoveries" class="headerlink" title="cluster.routing.allocation.node_concurrent_incoming_recoveries"></a>cluster.routing.allocation.node_concurrent_incoming_recoveries</h3><p>一个节点允许发生多少并发写入分片恢复。传入恢复是在节点上分配目标分片（很可能是副本，除非分片正在重新定位）的恢复。</p>
<h3 id="cluster-routing-allocation-node-concurrent-outgoing-recoveries"><a href="#cluster-routing-allocation-node-concurrent-outgoing-recoveries" class="headerlink" title="cluster.routing.allocation.node_concurrent_outgoing_recoveries"></a>cluster.routing.allocation.node_concurrent_outgoing_recoveries</h3><p>一个节点上允许发生多少并发传出分片恢复。传出恢复是在节点上分配源分片（很可能是主分片，除非分片正在重新定位）的恢复。</p>
<h3 id="cluster-routing-allocation-node-concurrent-recoveries"><a href="#cluster-routing-allocation-node-concurrent-recoveries" class="headerlink" title="cluster.routing.allocation.node_concurrent_recoveries"></a>cluster.routing.allocation.node_concurrent_recoveries</h3><p>一个设置以上两个参数的快捷方式参数。</p>
<h3 id="cluster-routing-allocation-node-initial-primaries-recoveries"><a href="#cluster-routing-allocation-node-initial-primaries-recoveries" class="headerlink" title="cluster.routing.allocation.node_initial_primaries_recoveries"></a>cluster.routing.allocation.node_initial_primaries_recoveries</h3><p>虽然副本的恢复通过网络进行，但节点重新启动后未分配的主节点的恢复使用本地磁盘中的数据。这些应该很快，以便更多的初始主恢复可以在同一节点上并行发生。</p>
<h3 id="cluster-routing-allocation-same-shard-host"><a href="#cluster-routing-allocation-same-shard-host" class="headerlink" title="cluster.routing.allocation.same_shard.host"></a>cluster.routing.allocation.same_shard.host</h3><p>允许根据主机名和主机地址执行检查，以防止在单个主机上分配同一分片的多个实例。默认为 false，表示默认不执行任何检查。仅当在同一台计算机上启动多个节点时，此设置才适用。</p>
<h2 id="分片平衡设置"><a href="#分片平衡设置" class="headerlink" title="分片平衡设置"></a>分片平衡设置</h2><p>可以通过以下参数控制集群中分片平衡过程。</p>
<h3 id="cluster-routing-rebalance-enable"><a href="#cluster-routing-rebalance-enable" class="headerlink" title="cluster.routing.rebalance.enable"></a>cluster.routing.rebalance.enable</h3><p>为特定类型的分片启用或禁用重新平衡</p>
<ul>
<li>all 允许所有类型的分片参与平衡</li>
<li>primaries 只允许主分片参与平衡</li>
<li>replicas 只允许副本分片参与平衡</li>
<li>none 不允许任何索引及任何分片参与平衡</li>
</ul>
<h3 id="cluster-routing-allocation-allow-rebalance"><a href="#cluster-routing-allocation-allow-rebalance" class="headerlink" title="cluster.routing.allocation.allow_rebalance"></a>cluster.routing.allocation.allow_rebalance</h3><p>用来控制rebalance触发条件</p>
<ul>
<li>always  始终允许重新平衡；</li>
<li>indices_primaries_active  仅在所有主分片都成功被分配后；</li>
<li>indices_all_active （默认）仅当所有分片都成功被分配后；</li>
</ul>
<h3 id="cluster-routing-allocation-cluster-concurrent-rebalance"><a href="#cluster-routing-allocation-cluster-concurrent-rebalance" class="headerlink" title="cluster.routing.allocation.cluster_concurrent_rebalance"></a>cluster.routing.allocation.cluster_concurrent_rebalance</h3><p>允许集群级别的并发分片平衡数，这个参数只限制由于集群中分片不平衡导致的再平衡过程，并不限制由于分配过滤和强制感知导致的分片再分配。</p>
<h2 id="分片平衡启发式设置"><a href="#分片平衡启发式设置" class="headerlink" title="分片平衡启发式设置"></a>分片平衡启发式设置</h2><p>以下设置一起使用来确定每个分片的分配位置。当没有允许的重新平衡操作可以使任何节点的权重更接近任何其他节点的权重超过 balance.threshold 时，集群达到平衡。</p>
<h3 id="cluster-routing-allocation-balance-shard"><a href="#cluster-routing-allocation-balance-shard" class="headerlink" title="cluster.routing.allocation.balance.shard"></a>cluster.routing.allocation.balance.shard</h3><p>定义节点上分配的分片总数的权重因子（浮点数）。默认为 0.45f。提高这个值会增加集群中所有节点的分片数量均衡的趋势（更加积极）。</p>
<h3 id="cluster-routing-allocation-balance-index"><a href="#cluster-routing-allocation-balance-index" class="headerlink" title="cluster.routing.allocation.balance.index"></a>cluster.routing.allocation.balance.index</h3><p>定义在特定节点上分配的每个索引的分片数量的权重因子（浮点数）。默认为 0.55f。提高这个值会增加集群中所有节点上每个索引的分片数量均衡的趋势。</p>
<h3 id="cluster-routing-allocation-balance-threshold"><a href="#cluster-routing-allocation-balance-threshold" class="headerlink" title="cluster.routing.allocation.balance.threshold"></a>cluster.routing.allocation.balance.threshold</h3><p>应执行的操作的最小优化值（非负浮点数）。默认为 1.0f。提高这个值将导致集群在优化分片平衡方面不那么积极。</p>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>公式=<code>weight(node) = (number_of_shards_on_node * cluster.routing.allocation.balance.shard) + (number_of_indices_on_node * cluster.routing.allocation.balance.index)</code><br>假设有三个节点A、B、C，节点上分别有以下分片和索引数量：</p>
<ul>
<li>节点A：10个分片，5个索引</li>
<li>节点B：8个分片，5个索引</li>
<li>节点C：12个分片，6个索引</li>
</ul>
<p>假设使用默认配置则：</p>
<ul>
<li>节点A的权重 = (10 * 0.45) + (5 * 0.55) = 4.5 + 2.75 = 7.25</li>
<li>节点B的权重 = (8 * 0.45) + (5 * 0.55) = 3.6 + 2.75 = 6.35</li>
<li>节点C的权重 = (12 * 0.45) + (6 * 0.55) = 5.4 + 3.3 = 8.7</li>
</ul>
<p>计算标准差得到: 0.9680，比 1 小不会触发rebalancing，如果超过阈值，则会把权重高的节点往权重低的节点迁移。</p>
<h2 id="基于磁盘的分片分配设置"><a href="#基于磁盘的分片分配设置" class="headerlink" title="基于磁盘的分片分配设置"></a>基于磁盘的分片分配设置</h2><p>Elasticsearch 在决定是向该节点分配新分片还是主动将分片从该节点重新定位之前，会考虑该节点上的可用磁盘空间。</p>
<h3 id="cluster-routing-allocation-disk-threshold-enabled"><a href="#cluster-routing-allocation-disk-threshold-enabled" class="headerlink" title="cluster.routing.allocation.disk.threshold_enabled"></a>cluster.routing.allocation.disk.threshold_enabled</h3><p>默认true，开启基于磁盘的使用量来决定是否分配分片</p>
<h3 id="cluster-routing-allocation-disk-watermark-low-低水位线"><a href="#cluster-routing-allocation-disk-watermark-low-低水位线" class="headerlink" title="cluster.routing.allocation.disk.watermark.low 低水位线"></a>cluster.routing.allocation.disk.watermark.low 低水位线</h3><p>控制磁盘使用的低水位线。默认为 85%，这意味着 Elasticsearch 不会将分片分配给磁盘使用率超过 85% 的节点。它还可以设置为绝对字节值（例如 500mb），以防止 Elasticsearch 在可用空间小于指定数量时分配分片。此设置对新创建索引的主分片没有影响，但会阻止分配其副本。</p>
<h3 id="cluster-routing-allocation-disk-watermark-high-高水位线"><a href="#cluster-routing-allocation-disk-watermark-high-高水位线" class="headerlink" title="cluster.routing.allocation.disk.watermark.high 高水位线"></a>cluster.routing.allocation.disk.watermark.high 高水位线</h3><p>控制高水位线。它默认为 90%，这意味着 Elasticsearch 将尝试将分片重新分配到磁盘使用率低于 90% 的节点上。它还可以设置为绝对字节值（类似于低水位线），以便在节点的可用空间小于指定数量时将分片重新定位到远离节点的位置。此设置会影响所有分片的分配，无论之前是否已分配。</p>
<h3 id="cluster-routing-allocation-disk-watermark-flood-stage-范洪水位线"><a href="#cluster-routing-allocation-disk-watermark-flood-stage-范洪水位线" class="headerlink" title="cluster.routing.allocation.disk.watermark.flood_stage 范洪水位线"></a>cluster.routing.allocation.disk.watermark.flood_stage 范洪水位线</h3><p>控制洪水阶段水位线，默认为95%。 Elasticsearch 在节点上分配了一个或多个分片且至少有一个磁盘超过泛洪阶段的每个索引上强制执行只读索引块 (index.blocks.read_only_allow_delete)。此设置是防止节点耗尽磁盘空间的最后手段。当磁盘利用率低于高水位线时，索引块会自动释放。<br>会阻止事件写入，可能会对一些系统索引产生影响导致集群不可用。</p>
<p>百分比和具体值不能混用，百分比是已使用空间，具体值表示剩余空间。</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/blog/tags/ElasticSearch/" rel="tag"><i class="fa fa-tag"></i> ElasticSearch</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2024/06/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="prev" title="计算机网络网络安全">
      <i class="fa fa-chevron-left"></i> 计算机网络网络安全
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2024/06/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE/" rel="next" title="计算机网络网络安全协议">
      计算机网络网络安全协议 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E4%B8%8D%E4%BC%9A%E5%B9%B3%E8%A1%A1%E5%8D%95%E8%8A%82%E7%82%B9%E4%B8%8A%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">1.</span> <span class="nav-text">ES 不会平衡单节点上的数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E7%BA%A7%E5%88%AB%E7%9A%84%E5%88%86%E7%89%87%E5%88%86%E9%85%8D%E5%92%8C%E8%B7%AF%E7%94%B1%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">集群级别的分片分配和路由设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E7%BA%A7%E5%88%AB%E7%9A%84%E5%88%86%E7%89%87%E5%88%86%E7%89%87%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">集群级别的分片分片设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-enable"><span class="nav-number">3.1.</span> <span class="nav-text">cluster.routing.allocation.enable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-node-concurrent-incoming-recoveries"><span class="nav-number">3.2.</span> <span class="nav-text">cluster.routing.allocation.node_concurrent_incoming_recoveries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-node-concurrent-outgoing-recoveries"><span class="nav-number">3.3.</span> <span class="nav-text">cluster.routing.allocation.node_concurrent_outgoing_recoveries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-node-concurrent-recoveries"><span class="nav-number">3.4.</span> <span class="nav-text">cluster.routing.allocation.node_concurrent_recoveries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-node-initial-primaries-recoveries"><span class="nav-number">3.5.</span> <span class="nav-text">cluster.routing.allocation.node_initial_primaries_recoveries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-same-shard-host"><span class="nav-number">3.6.</span> <span class="nav-text">cluster.routing.allocation.same_shard.host</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E7%89%87%E5%B9%B3%E8%A1%A1%E8%AE%BE%E7%BD%AE"><span class="nav-number">4.</span> <span class="nav-text">分片平衡设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-rebalance-enable"><span class="nav-number">4.1.</span> <span class="nav-text">cluster.routing.rebalance.enable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-allow-rebalance"><span class="nav-number">4.2.</span> <span class="nav-text">cluster.routing.allocation.allow_rebalance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-cluster-concurrent-rebalance"><span class="nav-number">4.3.</span> <span class="nav-text">cluster.routing.allocation.cluster_concurrent_rebalance</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E7%89%87%E5%B9%B3%E8%A1%A1%E5%90%AF%E5%8F%91%E5%BC%8F%E8%AE%BE%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">分片平衡启发式设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-balance-shard"><span class="nav-number">5.1.</span> <span class="nav-text">cluster.routing.allocation.balance.shard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-balance-index"><span class="nav-number">5.2.</span> <span class="nav-text">cluster.routing.allocation.balance.index</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-balance-threshold"><span class="nav-number">5.3.</span> <span class="nav-text">cluster.routing.allocation.balance.threshold</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BE%E4%BE%8B"><span class="nav-number">5.4.</span> <span class="nav-text">举例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E7%A3%81%E7%9B%98%E7%9A%84%E5%88%86%E7%89%87%E5%88%86%E9%85%8D%E8%AE%BE%E7%BD%AE"><span class="nav-number">6.</span> <span class="nav-text">基于磁盘的分片分配设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-disk-threshold-enabled"><span class="nav-number">6.1.</span> <span class="nav-text">cluster.routing.allocation.disk.threshold_enabled</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-disk-watermark-low-%E4%BD%8E%E6%B0%B4%E4%BD%8D%E7%BA%BF"><span class="nav-number">6.2.</span> <span class="nav-text">cluster.routing.allocation.disk.watermark.low 低水位线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-disk-watermark-high-%E9%AB%98%E6%B0%B4%E4%BD%8D%E7%BA%BF"><span class="nav-number">6.3.</span> <span class="nav-text">cluster.routing.allocation.disk.watermark.high 高水位线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster-routing-allocation-disk-watermark-flood-stage-%E8%8C%83%E6%B4%AA%E6%B0%B4%E4%BD%8D%E7%BA%BF"><span class="nav-number">6.4.</span> <span class="nav-text">cluster.routing.allocation.disk.watermark.flood_stage 范洪水位线</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="朱佳东"
      src="/blog/images/avatar.png">
  <p class="site-author-name" itemprop="name">朱佳东</p>
  <div class="site-description" itemprop="description">melon</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">75</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zjd-melo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zjd-melo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:826695779@qq.com" title="E-Mail → mailto:826695779@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">朱佳东</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">268k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">4:03</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  

</body>
</html>
